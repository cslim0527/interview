[영상자료: 우아한테크 10분 테크톡](https://www.youtube.com/watch?v=-4ZsGy1LOiE)

## 웹 저장소와 쿠키

### 쿠키
1. 쿠키의 특징
- 쿠키는 요청 시 Header 실려 전송된다.
- 만료 기간을 지정 할 수 있다.
```
Set-Cookie: <cookie-name> = <cookie-value>; Expires=<date>
Set-Cookie: <cookie-name> = <cookie-value>; Max-Age=<number>

❗ 만약 Expires와 Max-Age가 둘다 존재한다면 Expires는 무시된다.
```

2. 영구 쿠키(Persistent Cookie)와 세션쿠키(Session Cookie)

|          |     영구 쿠키     |     세션쿠키      |
|----------|:-------------:|:-------------:|
| 만료기간     |      있음       |      없음       |
| 삭제 시점    | 만료기간이 끝난 후 | 브라우저 종료 시 삭제  |

3. 쿠키의 문제점
- CSRF: 사용자의 권한을 이용한 공격 -> 쿠키가 자동으로 전송된다는 특징을 이용해서 사이트에 로그인이 되어있는 사용자에게 악성 스크립트를 실행 시켜 
비밀번호를 변경하거나 결제 요청을 하는등의 악의적인 요청을 하는것을 말한다.
- XSS(Reflected XSS/Stored XSS/DOM-based XSS): 사용자의 민감한 정보 탈취(토큰) -> 악성스크립트를 실행시켜 사용자의 토큰과 같은 민감한 정보를 탈취하는 것이다.
- 부족한 저장 용량: 쿠키는 4KB의 제한된 용량의 저장소이다. 
- HTTP 요청 시 자동으로 모든 쿠키를 전송하기때문에 불필요한 트래픽이 증가 시킬 수 있다.

### 웹스토리지
```
쿠키의 문제점을 보완하기 위해서 HTML5에 웹스토리지가 등장하였다.
```

1. 보완된 특징
- 5MB의 저장용량으로 쿠키의 부족한 저장 용량을 해결
- 요청 시 Headers에 전송하지 않아 CSRF, XXS, 트래픽 문제를 해결
- 문자열만 저장 가능하지만 직렬화를 통하여 객체를 저장 할 수 있다.

2. 종류와 특징 (로컬 스토리지와 세션 스토리지)

|       | 로컬 스토리지  |   세션 스토리지   |
|-------|:--------:|:-----------:|
| 저장 범위 | 도메인/브라우저 | 도메인/브라우저/탭  |
| 삭제 시점 | 직접 삭제 시  |   탭 종료 시    |

3. 고려해야할 점
- 문자열만 저장 가능하기 때문에 객체를 다룰때는 직렬화 역 직렬화를 사용하여야 한다.
```javascript
// 직렬화
JSON.stringify(obj)

// 역직렬화
JSON.parse(json)
```
- 웹스토리지를 지원하지 않거나, 웹 스토리지 비활성화 설정이 가능한 브라우저를 대비해 에러 처리를 필수로 해야한다.

4. 문제점
- 자바스크립트로 접근 가능하기에 보안에 취약하다.
- 브라우저/탭 (세션스토리지) 간 공유가 불가하여 독립된 스토리지로만 활용된다.
- 만료기간을 설정 할 수 없다.
- 동기적으로 실행되기 때문에 메인 스레드가 블로킹 될 수 있다. 따라서 용량이 큰 데이터를 다뤄야 할 경우 IndexedDB를 고려해야 한다.

5. 쿠키와 웹스토리지의 활용

![](화면%20캡처%202022-01-09%20204524.png)

6. 보안 문제의 해결책
```
XXS 보안 강화
- HttpOnly를 사용하면 자바스크립트로 쿠키에 접근할수 없기때문에 XSS 보안문제를 해결 할 수 있다.
- innerHTML을 사용하지 않는 코드를 작성하여 자바스크립트 코드 삽입을 불가하게 만든다.
꼭 사용해야한다면 XSS 보안 라이브러리(sanitize-html, DOMPurify) 등을 사용하여야 한다.
```

```
CSRF 보안 강화
- SameSite(같은 도메인이 아니면 쿠키를 전송하지 않게 하는 옵션)를 사용한다. 
- Referer 검증(요청 온 사이트의 도메인을 확인)하여 CSRF를 문제를 강화 할 수 있다.
```
